# Docker Compose for local Pi-hole testing

services:
  pihole:
    image: pihole/pihole:latest
    container_name: pihole-test
    ports:
      - "8080:80"
      - "8443:443"
      # DNS ports commented out to avoid conflict with local resolver
      # - "5353:53/tcp"
      # - "5353:53/udp"
    environment:
      # Pi-hole v6 uses FTLCONF_ prefix for configuration
      FTLCONF_webserver_api_password: "test123"
      FTLCONF_webserver_api_max_sessions: "1024"
      TZ: "UTC"
      # Disable DHCP for testing
      FTLCONF_dhcp_active: "false"
    volumes:
      - pihole-data:/etc/pihole
      - dnsmasq-data:/etc/dnsmasq.d
    restart: unless-stopped
    cap_add:
      - NET_ADMIN
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/api/info/version"]
      interval: 10s
      timeout: 5s
      retries: 10
      start_period: 30s

volumes:
  pihole-data:
  dnsmasq-data:
